Week 4 Tutorial | Denoising

1. Load the class node:
```
sinteractive --reservation=aneq505 --time=02:00:00 --partition=amilan --nodes=1 --ntasks=8 --qos=normal

```

2. Load your Qiime environment:
```
module purge  
  
module load qiime2/2024.10_amplicon

```

3. Let's navigate to the correct place. Use `cd` to move into your **decomp****_tutorial** **dada2** folder. Use `pwd` to make sure you're in the correct place.
```
`cd /scratch/alpine/$USER/decomp_tutorial/dada2`

```

4. Use DADA2 to denoise our sequences. Because we have two sequencing runs, we have to do this twice.
```
#this will take about 22 mins total  
  
  
#denoise for run 2  
qiime dada2 denoise-paired \--i-demultiplexed-seqs ../demux/demux_run2.qza \--p-trunc-len-f 150 \--p-trunc-len-r 150 \--p-n-threads 8 \--o-table table_run2.qza \--o-representative-sequences seqs_run2.qza \--o-denoising-stats dada2_stats_run2.qza  
  
  
#denoise for run 3  
qiime dada2 denoise-paired \--i-demultiplexed-seqs ../demux/demux_run3.qza \--p-trunc-len-f 150 \--p-trunc-len-r 150 \--p-n-threads 8 \--o-table table_run3.qza \--o-representative-sequences seqs_run3.qza \--o-denoising-stats dada2_stats_run3.qza

```

5. Let's get a visualization of each of these stats outputs for each run
```
qiime metadata tabulate \--m-input-file dada2_stats_run2.qza \--o-visualization dada2_stats_run2.qzv  
  
qiime metadata tabulate \--m-input-file dada2_stats_run3.qza \--o-visualization dada2_stats_run3.qzv

```

6. DADA2 TABLE FILE: Merge denoised tables - required when you have samples from multiple sequencing runs like we have here. Then visualize the merged table so all samples are in one place.
```
qiime feature-table merge \--i-tables table_run2.qza \--i-tables table_run3.qza \--o-merged-table table.qza  
  
qiime feature-table summarize \--i-table table.qza \--o-visualization table.qzv \--m-sample-metadata-file ../metadata/metadata.txt

```

7.  DADA2 SEQS FILE:
```
qiime feature-table merge-seqs \--i-data seqs_run2.qza \--i-data seqs_run3.qza \--o-merged-data seqs.qza  
  
qiime feature-table tabulate-seqs \--i-data seqs.qza \--o-visualization seqs.qzv

```

8. Create a test job and run it: Go to OnDemand and create a new file in your slurm directory, call it "test.sh", click edit to open and edit the file.
```
#!/bin/bash  
#SBATCH --job-name=test  
#SBATCH --nodes=1  
#SBATCH --ntasks=2  
#SBATCH --partition=amilan  
#SBATCH --time=01:00:00  
#SBATCH --mail-type=ALL  
#SBATCH --mail-user=YOUR_USERNAME@colostate.edu  
#SBATCH --output=slurm-%j.out  
#SBATCH --qos=normal  
  
#Activate qiime  
  
module purge  
module load qiime2/2024.10_amplicon  
  
# command goes here  
OUTFILE="message_${SLURM_JOB_ID}.txt"  
echo "status report" > $OUTFILE  
echo "Job ID: $SLURM_JOB_ID" >> $OUTFILE  
echo "Node: $(hostname)" >> $OUTFILE  
echo "Timestamp: $(date)" >> $OUTFILE  
echo "You ran your first job!" >> $OUTFILE

```

9. Run the bash script we created from terminal, to initiate job:
```
dos2unix test.sh
sbatch test.sh

```

